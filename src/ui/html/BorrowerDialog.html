<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <?!= include('Styles'); ?>
  </head>
  <body>
    <div class="sidebar-container">
      <form id="borrower-form">
        <input type="hidden" id="borrower-id" value="<?= borrower ? borrower.id : '' ?>">

        <div class="form-group">
          <label for="name">Name *</label>
          <input type="text" id="name" name="name" required
                 value="<?= borrower ? borrower.name : '' ?>">
        </div>

        <div class="form-group">
          <label for="email">Email *</label>
          <input type="email" id="email" name="email" required
                 value="<?= borrower ? borrower.email : '' ?>">
        </div>

        <div class="form-group">
          <label for="phone">Phone</label>
          <input type="tel" id="phone" name="phone"
                 value="<?= borrower ? borrower.phone : '' ?>">
        </div>

        <? if (isEdit) { ?>
        <div class="form-group">
          <label for="status">Status</label>
          <select id="status" name="status">
            <option value="active" <?= borrower && borrower.status === 'active' ? 'selected' : '' ?>>Active</option>
            <option value="suspended" <?= borrower && borrower.status === 'suspended' ? 'selected' : '' ?>>Suspended</option>
            <option value="inactive" <?= borrower && borrower.status === 'inactive' ? 'selected' : '' ?>>Inactive</option>
          </select>
        </div>
        <? } ?>

        <div class="form-group">
          <label for="notes">Notes</label>
          <textarea id="notes" name="notes" rows="3"><?= borrower ? borrower.notes : '' ?></textarea>
        </div>

        <div class="form-row">
          <button type="submit" class="btn btn-primary">
            <?= isEdit ? 'Save Changes' : 'Add Borrower' ?>
          </button>
          <button type="button" class="btn btn-secondary" onclick="google.script.host.close()">
            Cancel
          </button>
        </div>
      </form>

      <div id="status-area" class="status-area"></div>
    </div>

    <script>
      function showStatus(message, type) {
        const statusArea = document.getElementById('status-area');
        statusArea.textContent = message;
        statusArea.className = 'status-area ' + type;
      }

      document.getElementById('borrower-form').addEventListener('submit', function(e) {
        e.preventDefault();
        showStatus('Saving...', 'loading');

        const data = {
          id: document.getElementById('borrower-id').value || undefined,
          name: document.getElementById('name').value,
          email: document.getElementById('email').value,
          phone: document.getElementById('phone').value,
          notes: document.getElementById('notes').value
        };

        google.script.run
          .withSuccessHandler(function(result) {
            if (result.success) {
              showStatus('Saved successfully!', 'success');
              setTimeout(function() {
                google.script.host.close();
              }, 1000);
            } else {
              showStatus(result.error || 'Save failed', 'error');
            }
          })
          .withFailureHandler(function(error) {
            showStatus(error.message || 'An error occurred', 'error');
          })
          .saveBorrower(data);
      });
    </script>
  </body>
</html>
