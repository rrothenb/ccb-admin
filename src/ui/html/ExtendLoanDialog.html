<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <?!= include('Styles'); ?>
  </head>
  <body>
    <div class="sidebar-container">
      <form id="extend-form">
        <input type="hidden" id="loan-id" value="<?= loanId ?>">

        <div class="form-group">
          <label for="days">Extend by (days)</label>
          <input type="number" id="days" value="14" min="1" max="90">
        </div>

        <div class="form-row">
          <button type="submit" class="btn btn-primary">Extend Loan</button>
          <button type="button" class="btn btn-secondary" onclick="google.script.host.close()">
            Cancel
          </button>
        </div>
      </form>

      <div id="status-area" class="status-area"></div>
    </div>

    <script>
      function showStatus(message, type) {
        const statusArea = document.getElementById('status-area');
        statusArea.textContent = message;
        statusArea.className = 'status-area ' + type;
      }

      document.getElementById('extend-form').addEventListener('submit', function(e) {
        e.preventDefault();
        showStatus('Extending loan...', 'loading');

        const loanId = document.getElementById('loan-id').value;
        const days = parseInt(document.getElementById('days').value) || 14;

        google.script.run
          .withSuccessHandler(function(result) {
            if (result.success) {
              showStatus('Loan extended!', 'success');
              setTimeout(function() {
                google.script.host.close();
              }, 1000);
            } else {
              showStatus(result.error || 'Extension failed', 'error');
            }
          })
          .withFailureHandler(function(error) {
            showStatus(error.message || 'An error occurred', 'error');
          })
          .extendLoan(loanId, days);
      });
    </script>
  </body>
</html>
